<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>個人面談　日程調整</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<!--header-->
<div class="container-fluid">
  <h1>個人面談　日程調整</h1>
  <h2 th:switch="${header}">
    <div class="link" th:case="'default'">
      <a href="/schedule/studentManagement">児童データ管理</a>
      <a href="/schedule/timesList">面談枠管理</a>
    </div>
    <div class="cancel" th:case="'time'">
      <a th:text="'選択中の日時：' + ${#temporals.format(selectedTime, 'yyyy年MM月dd日 HH時mm分')}">
      </a>
      <a th:each="student:${students}" th:if="${student.currentSet} == ${selectedTime}"
         th:text="${student.name}">
      </a>
      <a href="/schedule">キャンセル</a>
    </div>
    <div class="cancel" th:case="'student'">
      <a th:text="'選択中の児童：' + ${selectedStudent.name}"></a>
      <span th:text="${#lists.size(selectedStudent.requestedTimes)} + '枠希望'"></span>
      <span th:unless="${#lists.isEmpty(selectedStudent.brotherSet)}" th:text="'兄弟あり'"></span>
      <a href="/schedule">キャンセル</a>
    </div>
  </h2>
</div>
<!--header終わり-->
<!--main-->
<div class="container-fluid">
  <div class="columns">
    <a class="allTime">日程</a>
    <a class="current-student">児童</a>
    <a class="other-students">未定の児童</a>
  </div>
  <div class="schedule" th:each="time:${allTime}">
    <div class="allTime">
      <a th:if="${time.value} == null or ${time.value} < 5"
         th:href="@{/schedule/time/{time}(time=${#temporals.format(time.key, 'yyyy-MM-dd''T''HH:mm')})}">
        <span th:text="*{#temporals.format(time.key, 'yyyy年MM月dd日 HH時mm分')}">2025/07/31</span>
        <span> ～ </span>
        <span th:text="*{#temporals.format(time.key.plusMinutes(15), 'HH時mm分')}">2025/07/31</span>
        <span class="current-students" th:each="student : ${students}"
              th:if="${student.currentSet} == ${time.key}" th:text="${student.name}"></span>
      </a>
      <a th:if="${time.value} != null and ${time.value} >= 5">
        <span th:text="*{#temporals.format(time.key, 'yyyy年MM月dd日 HH時mm分')}">2025/07/31</span>
        <span> ～ </span>
        <span th:text="*{#temporals.format(time.key.plusMinutes(15), 'HH時mm分')}">2025/07/31</span>
        <span class="current-students" th:each="student : ${students}"
              th:if="${student.currentSet} == ${time.key}" th:text="${student.name}"></span>
      </a>
    </div>
    <div class="button" th:switch="${time.value}">
      <form th:case="1" th:action="@{/schedule/delete/{time}(time=${time.key})}" th:method="post">
        <input type="submit" class="btn btn-primary" value="削除">
      </form>
      <form th:case="2" th:action="@{/schedule/add}" th:method="post">
        <input type="hidden" name="targetTime" th:value="${time.key}">
        <input type="hidden" name="studentId" th:value="${studentId}">
        <input type="submit" class="btn btn-primary" value="追加">
      </form>
      <form th:case="3" th:action="@{/schedule/change}" th:method="post">
        <input type="hidden" name="studentId" th:value="${studentId}">
        <input type="hidden" name="targetTime" th:value="${time.key}">
        <input type="submit" class="btn btn-primary" value="交代する">
      </form>
      <form th:case="4" th:action="@{/schedule/move}" th:method="post">
        <input type="hidden" name="targetTime" th:value="${time.key}">
        <input type="hidden" name="selectedTime" th:value="${selectedTime}">
        <input type="submit" class="btn btn-primary" value="移動する">
      </form>
      <form th:case="6" th:action="@{/schedule/delete/{time}(time=${time.key})}" th:method="post">
        <input type="submit" class="btn btn-primary" value="削除">
      </form>
    </div>
  </div>
  <div class="other-students" th:each="student:${students}" th:if="${student.currentSet}==null">
    <a th:if="${student.colorFlag} != 3" th:href="@{/schedule/student/{id}(id=${student.id})}"
       th:text="${student.name}">
    </a>
    <a th:if="${student.colorFlag} == 3" th:text="${student.name}"></a>
    <span th:text="${#lists.size(student.requestedTimes)} + '枠希望'"></span>
    <span th:unless="${#lists.isEmpty(student.brotherSet)}" th:text="'兄弟あり'"></span>
    <div class="button" th:switch="${student.colorFlag}">
      <form th:case="1" th:action="@{/schedule/add}" th:method="post">
        <input type="hidden" name="studentId" th:value="${student.id}">
        <input type="hidden" name="targetTime" th:value="${selectedTime}">
        <input type="submit" class="btn btn-primary" value="追加">
      </form>
      <form th:case="2" th:action="@{/schedule/change}" th:method="post">
        <input type="hidden" name="studentId" th:value="${student.Id}">
        <input type="hidden" name="selectedTime" th:value="${selectedTime}">
        <input type="submit" class="btn btn-primary" value="交代する">
      </form>
    </div>
  </div>
</div>
<!--main終わり-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>